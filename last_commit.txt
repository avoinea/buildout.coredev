Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-02-21T08:31:49+01:00
Author: Timo Stollenwerk (tisto) <tisto@users.noreply.github.com>
Commit: https://github.com/plone/plone.restapi/commit/bde767e40c7952deb56ec401e86a43157c6f3629

Performance 5.2 (#871)

* Upgrade to Plone 5.1.6.

* Fix performance profile for py3.

* Add plone-5.2.x-performance.cfg.

* Upgrade performance.xml to jMeter 5.2.

* Add some perf test result graphs.

Files changed:
A performance/plone-5.2-py3-imac-pro-20191122/README.md
A performance/plone-5.2-py3-imac-pro-20191122/jmeter-anonymous-read.png
A performance/plone-5.2-py3-imac-pro-20191122/jmeter-authenticated-read.png
A performance/plone-5.2-py3-imac-pro-20191122/jmeter-authenticated-write.png
A plone-5.2.x-performance.cfg
M performance.jmx
M plone-5.1.x.cfg
M src/plone/restapi/tests/performance.py

b'diff --git a/performance.jmx b/performance.jmx\nindex da5e981d..2d8b1c1f 100644\n--- a/performance.jmx\n+++ b/performance.jmx\n@@ -1,5 +1,5 @@\n <?xml version="1.0" encoding="UTF-8"?>\n-<jmeterTestPlan version="1.2" properties="5.0" jmeter="5.0 r1840935">\n+<jmeterTestPlan version="1.2" properties="5.0" jmeter="5.2">\n   <hashTree>\n     <TestPlan guiclass="TestPlanGui" testclass="TestPlan" testname="plone.restapi" enabled="true">\n       <stringProp name="TestPlan.comments"></stringProp>\n@@ -40,6 +40,7 @@\n         <boolProp name="ThreadGroup.scheduler">false</boolProp>\n         <stringProp name="ThreadGroup.duration"></stringProp>\n         <stringProp name="ThreadGroup.delay"></stringProp>\n+        <boolProp name="ThreadGroup.same_user_on_next_iteration">true</boolProp>\n       </ThreadGroup>\n       <hashTree>\n         <ConfigTestElement guiclass="HttpDefaultsGui" testclass="ConfigTestElement" testname="HTTP Request Defaults" enabled="true">\n@@ -421,6 +422,7 @@\n         <boolProp name="ThreadGroup.scheduler">false</boolProp>\n         <stringProp name="ThreadGroup.duration"></stringProp>\n         <stringProp name="ThreadGroup.delay"></stringProp>\n+        <boolProp name="ThreadGroup.same_user_on_next_iteration">true</boolProp>\n       </ThreadGroup>\n       <hashTree>\n         <ConfigTestElement guiclass="HttpDefaultsGui" testclass="ConfigTestElement" testname="HTTP Request Defaults" enabled="true">\n@@ -834,6 +836,7 @@\n         <boolProp name="ThreadGroup.scheduler">false</boolProp>\n         <stringProp name="ThreadGroup.duration"></stringProp>\n         <stringProp name="ThreadGroup.delay"></stringProp>\n+        <boolProp name="ThreadGroup.same_user_on_next_iteration">true</boolProp>\n       </ThreadGroup>\n       <hashTree>\n         <ConfigTestElement guiclass="HttpDefaultsGui" testclass="ConfigTestElement" testname="HTTP Request Defaults" enabled="true">\n@@ -1243,6 +1246,7 @@\n         <boolProp name="ThreadGroup.scheduler">false</boolProp>\n         <stringProp name="ThreadGroup.duration"></stringProp>\n         <stringProp name="ThreadGroup.delay"></stringProp>\n+        <boolProp name="ThreadGroup.same_user_on_next_iteration">true</boolProp>\n       </ThreadGroup>\n       <hashTree>\n         <ConfigTestElement guiclass="HttpDefaultsGui" testclass="ConfigTestElement" testname="HTTP Request Defaults" enabled="true">\ndiff --git a/performance/plone-5.2-py3-imac-pro-20191122/README.md b/performance/plone-5.2-py3-imac-pro-20191122/README.md\nnew file mode 100644\nindex 00000000..f9752a1d\n--- /dev/null\n+++ b/performance/plone-5.2-py3-imac-pro-20191122/README.md\n@@ -0,0 +1,5 @@\n+# Performance Test Plone 5.2 / Python 3\n+\n+Hardware: iMac Pro\n+Date: 20191123\n+ \ndiff --git a/performance/plone-5.2-py3-imac-pro-20191122/jmeter-anonymous-read.png b/performance/plone-5.2-py3-imac-pro-20191122/jmeter-anonymous-read.png\nnew file mode 100644\nindex 00000000..14bcde20\nBinary files /dev/null and b/performance/plone-5.2-py3-imac-pro-20191122/jmeter-anonymous-read.png differ\ndiff --git a/performance/plone-5.2-py3-imac-pro-20191122/jmeter-authenticated-read.png b/performance/plone-5.2-py3-imac-pro-20191122/jmeter-authenticated-read.png\nnew file mode 100644\nindex 00000000..6f12dc71\nBinary files /dev/null and b/performance/plone-5.2-py3-imac-pro-20191122/jmeter-authenticated-read.png differ\ndiff --git a/performance/plone-5.2-py3-imac-pro-20191122/jmeter-authenticated-write.png b/performance/plone-5.2-py3-imac-pro-20191122/jmeter-authenticated-write.png\nnew file mode 100644\nindex 00000000..4df50644\nBinary files /dev/null and b/performance/plone-5.2-py3-imac-pro-20191122/jmeter-authenticated-write.png differ\ndiff --git a/plone-5.1.x.cfg b/plone-5.1.x.cfg\nindex 2fde6418..c31cee82 100644\n--- a/plone-5.1.x.cfg\n+++ b/plone-5.1.x.cfg\n@@ -1,5 +1,5 @@\n [buildout]\n extends =\n     base.cfg\n-    http://dist.plone.org/release/5.1.5/versions.cfg\n+    http://dist.plone.org/release/5.1.6/versions.cfg\n     versions.cfg\ndiff --git a/plone-5.2.x-performance.cfg b/plone-5.2.x-performance.cfg\nnew file mode 100644\nindex 00000000..dfc54eee\n--- /dev/null\n+++ b/plone-5.2.x-performance.cfg\n@@ -0,0 +1,27 @@\n+[buildout]\n+extends = plone-5.2.x.cfg\n+parts += instance plonesite\n+\n+[instance]\n+recipe = plone.recipe.zope2instance\n+user = admin:admin\n+http-address = 12345\n+deprecation-warnings = on\n+eggs =\n+    Plone\n+    Pillow\n+    plone.app.debugtoolbar\n+    plone.restapi [test]\n+\n+[plonesite]\n+recipe = collective.recipe.plonesite\n+site-id = Plone\n+instance = instance\n+profiles-initial = Products.CMFPlone:dependencies\n+profiles =\n+    plonetheme.barceloneta:default\n+    plone.app.contenttypes:plone-content\n+    plone.restapi:performance\n+upgrade-portal = False\n+upgrade-all-profiles = False\n+site-replace = True\ndiff --git a/src/plone/restapi/tests/performance.py b/src/plone/restapi/tests/performance.py\nindex 75ee3c28..bf3b57b1 100644\n--- a/src/plone/restapi/tests/performance.py\n+++ b/src/plone/restapi/tests/performance.py\n@@ -36,10 +36,10 @@ def set_image(obj):\n         from plone.namedfile.file import NamedBlobImage\n \n         filename = os.path.join(os.path.dirname(__file__), u"image.png")\n-        obj.image = NamedBlobImage(data=open(filename, "r").read(), filename=filename)\n+        obj.image = NamedBlobImage(data=open(filename, "rb").read(), filename=filename)\n     else:\n         filename = os.path.join(os.path.dirname(__file__), u"image.png")\n-        obj.setImage(open(filename, "r").read())\n+        obj.setImage(open(filename, "rb").read())\n \n \n def set_file(obj):\n@@ -48,13 +48,13 @@ def set_file(obj):\n \n         filename = os.path.join(os.path.dirname(__file__), u"file.pdf")\n         obj.file = NamedBlobFile(\n-            data=open(filename, "r").read(),\n+            data=open(filename, "rb").read(),\n             filename=filename,\n             contentType="application/pdf",\n         )\n     else:\n         filename = os.path.join(os.path.dirname(__file__), u"file.pdf")\n-        obj.setFile(open(filename, "r").read())\n+        obj.setFile(open(filename, "rb").read())\n \n \n def publish(content):\n'

