Repository: Products.CMFQuickInstallerTool


Branch: refs/heads/master
Date: 2020-02-12T13:11:23+01:00
Author: tschorr (tschorr) <t_schorr@gmx.de>
Commit: https://github.com/plone/Products.CMFQuickInstallerTool/commit/f1d95c7c93182256a06627f7e13258cd66a4e448

fix test

Files changed:
M Products/CMFQuickInstallerTool/tests/test_browser.py

b"diff --git a/Products/CMFQuickInstallerTool/tests/test_browser.py b/Products/CMFQuickInstallerTool/tests/test_browser.py\nindex 01a7390..84bebda 100644\n--- a/Products/CMFQuickInstallerTool/tests/test_browser.py\n+++ b/Products/CMFQuickInstallerTool/tests/test_browser.py\n@@ -94,19 +94,17 @@ def test_installProducts_post(self):\n         product = self._get_product_for_install(qi)\n         url = '%s/installProducts' % qi.absolute_url()\n         csrf_token = createToken()\n-        # First we need to get a url so we have a referer to get back to.\n-        # Otherwise we get a redirect to '', which means to 'installProducts',\n-        # which will fail because it is a GET request.\n-        self.browser.open(qi.absolute_url() + '/manage_installProductsForm')\n-        # Now the POST.\n-        self.browser.post(url, 'products:list=%s&_authenticator=%s' % (\n-            product, csrf_token))\n+        # z.testbrowser will choose POST if we provide data\n+        self.browser.open(\n+            url, 'products:list=%s&_authenticator=%s' % (\n+                product, csrf_token),\n+            referrer=qi.absolute_url() + '/manage_installProductsForm')\n         # The product must have successfully been installed.\n         self.assertTrue(qi.isProductInstalled(product),\n                         'Failed to install %s' % product)\n         self.assertEqual(\n             self.browser.url,\n-            'http://nohost/plone/portal_quickinstaller/manage_installProductsForm')\n+            'http://nohost/plone/portal_quickinstaller/manage_installProductsForm')  # noqa: E501\n \n     def test_installProducts_get(self):\n         # Now with a GET request.\n"

Repository: Products.CMFQuickInstallerTool


Branch: refs/heads/master
Date: 2020-02-12T13:15:48+01:00
Author: tschorr (tschorr) <t_schorr@gmx.de>
Commit: https://github.com/plone/Products.CMFQuickInstallerTool/commit/c88f8b006e1d192a63f63d941f857fbe04f8f896

update changelog

Files changed:
A news/23.bugfix

b'diff --git a/news/23.bugfix b/news/23.bugfix\nnew file mode 100644\nindex 0000000..3879cc0\n--- /dev/null\n+++ b/news/23.bugfix\n@@ -0,0 +1,2 @@\n+Fix failing test.\n+[tschorr]\n'

Repository: Products.CMFQuickInstallerTool


Branch: refs/heads/master
Date: 2020-02-15T20:43:22+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFQuickInstallerTool/commit/647a872fc07b8177be9b6d5fc4a495da263e771c

make it work in old and new z.testbrowser

Files changed:
M Products/CMFQuickInstallerTool/tests/test_browser.py

b"diff --git a/Products/CMFQuickInstallerTool/tests/test_browser.py b/Products/CMFQuickInstallerTool/tests/test_browser.py\nindex 84bebda..7f77a05 100644\n--- a/Products/CMFQuickInstallerTool/tests/test_browser.py\n+++ b/Products/CMFQuickInstallerTool/tests/test_browser.py\n@@ -94,11 +94,14 @@ def test_installProducts_post(self):\n         product = self._get_product_for_install(qi)\n         url = '%s/installProducts' % qi.absolute_url()\n         csrf_token = createToken()\n+        qs = 'products:list=%s&_authenticator=%s' % (product, csrf_token)\n+        referrer = qi.absolute_url() + '/manage_installProductsForm'\n         # z.testbrowser will choose POST if we provide data\n-        self.browser.open(\n-            url, 'products:list=%s&_authenticator=%s' % (\n-                product, csrf_token),\n-            referrer=qi.absolute_url() + '/manage_installProductsForm')\n+        try:\n+            self.browser.open(url, qs, referrer=referrer)\n+        except TypeError:\n+            # old version of z.testbrowser w/o referrer\n+            self.browser.open(url, qs)\n         # The product must have successfully been installed.\n         self.assertTrue(qi.isProductInstalled(product),\n                         'Failed to install %s' % product)\n"

Repository: Products.CMFQuickInstallerTool


Branch: refs/heads/master
Date: 2020-03-04T22:19:21+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFQuickInstallerTool/commit/689d1c6351049f0f100803246ee14d7f1ab92c55

Fix testbrowser referer problems by manually setting a Referer header.

Files changed:
M Products/CMFQuickInstallerTool/tests/test_browser.py

b"diff --git a/Products/CMFQuickInstallerTool/tests/test_browser.py b/Products/CMFQuickInstallerTool/tests/test_browser.py\nindex 7f77a05..fb14dc3 100644\n--- a/Products/CMFQuickInstallerTool/tests/test_browser.py\n+++ b/Products/CMFQuickInstallerTool/tests/test_browser.py\n@@ -96,12 +96,11 @@ def test_installProducts_post(self):\n         csrf_token = createToken()\n         qs = 'products:list=%s&_authenticator=%s' % (product, csrf_token)\n         referrer = qi.absolute_url() + '/manage_installProductsForm'\n+        # Passing a referrer has changed in recent versions of zope.testbrowser.\n+        # If we set it explicitly in the browser, it always works:\n+        self.browser.addHeader('Referer', referrer)\n         # z.testbrowser will choose POST if we provide data\n-        try:\n-            self.browser.open(url, qs, referrer=referrer)\n-        except TypeError:\n-            # old version of z.testbrowser w/o referrer\n-            self.browser.open(url, qs)\n+        self.browser.open(url, qs)\n         # The product must have successfully been installed.\n         self.assertTrue(qi.isProductInstalled(product),\n                         'Failed to install %s' % product)\n"

Repository: Products.CMFQuickInstallerTool


Branch: refs/heads/master
Date: 2020-03-05T13:51:50+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFQuickInstallerTool/commit/e257c9d9891bd2c7dbca0d2e9ff9b7e971a2dcda

Merge pull request #23 from plone/zope-4.2.1

Fix test failing with Zope 4.2.1

Files changed:
A news/23.bugfix
M Products/CMFQuickInstallerTool/tests/test_browser.py

b"diff --git a/Products/CMFQuickInstallerTool/tests/test_browser.py b/Products/CMFQuickInstallerTool/tests/test_browser.py\nindex 01a7390..fb14dc3 100644\n--- a/Products/CMFQuickInstallerTool/tests/test_browser.py\n+++ b/Products/CMFQuickInstallerTool/tests/test_browser.py\n@@ -94,19 +94,19 @@ def test_installProducts_post(self):\n         product = self._get_product_for_install(qi)\n         url = '%s/installProducts' % qi.absolute_url()\n         csrf_token = createToken()\n-        # First we need to get a url so we have a referer to get back to.\n-        # Otherwise we get a redirect to '', which means to 'installProducts',\n-        # which will fail because it is a GET request.\n-        self.browser.open(qi.absolute_url() + '/manage_installProductsForm')\n-        # Now the POST.\n-        self.browser.post(url, 'products:list=%s&_authenticator=%s' % (\n-            product, csrf_token))\n+        qs = 'products:list=%s&_authenticator=%s' % (product, csrf_token)\n+        referrer = qi.absolute_url() + '/manage_installProductsForm'\n+        # Passing a referrer has changed in recent versions of zope.testbrowser.\n+        # If we set it explicitly in the browser, it always works:\n+        self.browser.addHeader('Referer', referrer)\n+        # z.testbrowser will choose POST if we provide data\n+        self.browser.open(url, qs)\n         # The product must have successfully been installed.\n         self.assertTrue(qi.isProductInstalled(product),\n                         'Failed to install %s' % product)\n         self.assertEqual(\n             self.browser.url,\n-            'http://nohost/plone/portal_quickinstaller/manage_installProductsForm')\n+            'http://nohost/plone/portal_quickinstaller/manage_installProductsForm')  # noqa: E501\n \n     def test_installProducts_get(self):\n         # Now with a GET request.\ndiff --git a/news/23.bugfix b/news/23.bugfix\nnew file mode 100644\nindex 0000000..3879cc0\n--- /dev/null\n+++ b/news/23.bugfix\n@@ -0,0 +1,2 @@\n+Fix failing test.\n+[tschorr]\n"

